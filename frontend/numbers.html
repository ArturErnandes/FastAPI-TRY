<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Контакты</title>
</head>
<body>
    <h1>Список контактов</h1>

    <ul id="contacts-list"></ul>

    <h2>Добавить новый контакт</h2>

    <form id="add-contact-form">
        <label>
            Имя:
            <input type="text" id="name" required>
        </label>
        <br><br>

        <label>
            Телефон:
            <input type="text" id="phone" required>
        </label>
        <br><br>

        <button type="submit">Добавить</button>
    </form>

    <p id="result"></p>

    <br>
    <a href="index.html">← На главную</a>

    <script>
        const apiUrl = "http://127.0.0.1:8000";

        async function loadContacts() {
            const response = await fetch(`${apiUrl}/contacts`);
            const data = await response.json();

            const list = document.getElementById("contacts-list");
            list.innerHTML = "";

            data.forEach(contact => {
                const li = document.createElement("li");
                li.textContent = `${contact.name} — ${contact.ph_num}`;
                list.appendChild(li);
            });
        }

        document
            .getElementById("add-contact-form")
            .addEventListener("submit", async (event) => {
                event.preventDefault();

                const name = document.getElementById("name").value;
                const ph_num = document.getElementById("phone").value;

                const response = await fetch(`${apiUrl}/contacts`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        name: name,
                        ph_num: ph_num
                    })
                });

                if (response.ok) {
                    document.getElementById("result").innerText =
                        "Контакт успешно добавлен";
                    event.target.reset();
                    loadContacts();
                } else {
                    document.getElementById("result").innerText =
                        "Ошибка при добавлении контакта";
                }
            });

        loadContacts();
    </script>
</body>
</html>